<!doctype html><head><meta charset="utf-8"/><script>window.NIGHT=1</script><script src="../eveal.js/eveal.js"></script><style> .slide-background { background-image: url("i/bg.jpg"); }</style>
<meta property="title" content="Deno : Tracey Jaquith">
<!-- ğŸ˜Š fish: https://sylvan.apple.com/Videos/BO_A014_C008_SDR_20190719_SDR_2K_AVC.mov -->
<style>.frm {display:inline-block;width:33%} .frm img {border:0 !important} .fragm {font-size:.8em !important}</style>
</head><body>

# ğŸ¦• deno ğŸ¦•

Tracey Jaquith

Oct 2021

slides: tracey.dev.archive.org


---
@tracey_pooh ğŸ§¸<br>
Internet Archive ğŸ›ï¸<br><br>

TV Architect<br>
Â· video/audio Â· devops Â· javascript Â·<br>
</div>

---
# overview
- always opensource
  - no freemium locked features
- isomorphic
  - use web stds wherever possible, eg:
    - `fetch`
    - `URLSearchParams`
- die immediately unhandled promise
- import `.ts` files -- typescript 1st class; `deno --check` builtin

---
# releases

|  date  |   version   |
| ------ | ----------- |
| 2018/6 | (announced) |
| 2020/5 | v1.0.0      |
| 2021/9 | v1.14       |

_( point-release ~every 1-2mo )_


---
## 10* things I regret about Node
### Ryan Dahl
- https://www.youtube.com/watch?v=M3BM9TB-8yA
  - Jun 2018 (15min)
  - announces `deno` (deh - no ;-)

<small>(* maybe 7 ;-)</small>

---
## Not sticking with Promises
- 2009/6 added promises to node
- 2010/2 removed - to be minimal (one less obj per callback)
- its possible unified usage of promise in node would have sped the delivery of the standardization and async/await

---
## Security
- any node program can:
  - disk read/write
  - network access
  - env vars access
  - ...

"what about just a linter needing minimal access?"

---
## The Build System (biggest regret)
- modules linking to C libs
  - GYP to compile & link into node

- chrome used to use GYP
  - but now Node is the sole user

- funky interface, python adaptation of JSON
  - node has several unnecessary complex wrappers around it

---
## package.json
- should have included `npm` in `node`
  - making `npm` the standard of the `node` distribution

- centralized (privately controlled) repository for modules

- `require('sommodule')` isnt specific
  - `package.json` -or-
  - local `node_modules` folder -or-
  - npm's database

- unnecessary abstraction to rise the concept of a 'module' as a directory of files
- concept not web-like
- includes unnecessary information, such as license, repository ..

---
## node_modules
- module resolution algorithm is wildly complex

- "vendored-by-default" has good intentions
  - but `$NODE_PATH` would have worked

- deviates from browser

---
## Require without .js extension
- needlessly less explicit
- not how browser works
- module loader has to guess

---
## index.js
- needlessly complicated the module loading system
- especially unnecessary after `require` supported `package.json`


---
## CDN
- https://www.skypack.dev/
- https://esm.sh
  - https://github.com/alephjs/esm.sh/blob/master/HOSTING.md
  - https://git.archive.org/www/esm/-/blob/master/Dockerfile
  - https://esm.archive.org
  - â˜ğŸ½ user privacy ğŸ‘ğŸ¼

---
## CDN
include your JS (and more) as-needed

```html
<div id="x">ğŸ¦•</div>

<script type="module">
import $ from 'https://esm.archive.org/jquery'

$('#x').animate({ 'font-size': 400 })
</script>
```
[app.htm](app.htm)


---
## lit
- https://www-av-deno.dev.archive.org/
- https://git.archive.org/www/av/-/blob/deno/www/index.html
- https://git.archive.org/www/av/-/blob/deno/www/js/router.js
- https://git.archive.org/www/av/-/blob/deno/www/js/search-results.js

```js
import { LitElement, html, css } from 'https://esm.archive.org/lit'
```

---
## we could get rid of:
  - `node`
  - `npm`
    - `npm i`
    - `npm ci`
    - `npm run build`
    - `npm run serve`
  - `node_modules`
  - `webpack`
  - **1GB** of 3rd party code in every `petabox` image & every CI/CD phase

---
## we could...
- import `bookreader`

```js
import BookReader from 'https://esm.archive.org/@internetarchive/bookreader/src/BookReader.js'
```
from https://www.npmjs.com/package/@internetarchive/bookreader


---
# ğŸ“– demo
- https://www-av-deno.dev.archive.org/demo/bookreader.htm
- file:///Users/tracey/av/www/demo/bookreader.htm
  - â˜ğŸ½ this works as a **[file]** reference ğŸ‰

---
## we could..
- import radio player directly
  - `.ts` => `.js` dynamic through https://esm.archive.org

---
## handy links
- https://doc.deno.land/builtin/stable
  - standard / builtin object & methods
  - `Deno.args`
  - `Deno.env`
  - `Deno.readTextFileSync`
- https://deno.land/std
  - https://deno.land/std/node
    - `node`-compatible methods
- https://deno.land/x
  - user-maintained modules

---
## first Hack ğŸ‘©â€ğŸ’»

- wanted simple `deno` static file server
  - **with** 404 redir back to `index.html` (to re-route, eg: /details/IDENTIFIER)

- looked around, many _close_ - but deno std looked closest:
  - https://deno.land/std/http/file_server.ts

---
## first Hack ğŸ‘©â€ğŸ’»
- ğŸ´ a few lines later..
  - https://github.com/traceypooh/deno_std/commit/c0d2cabfaf4badc810271eed13cc4953aeade0dd

---
## first Hack ğŸ‘©â€ğŸ’»
et voila! ğŸ‰

```sh
deno run --allow-net --allow-read \
  https://raw.githubusercontent.com/traceypooh/deno_std/main/http/file_server.ts \
    -p 5000 --cors
```

- powers https://www-av-deno.dev.archive.org/
  - [.. /details/commute](https://www-av-deno.dev.archive.org/details/commute)

---
<!-- .slide: data-background="https://media.giphy.com/media/q4ICE9wYvOwBG/giphy.gif" -->
# The End
## Thanks! ğŸ™
